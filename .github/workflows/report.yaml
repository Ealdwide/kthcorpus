# Workflow derived from https://github.com/r-lib/actions/tree/v2/examples
# Need help debugging build failures? Start at https://github.com/r-lib/actions#where-to-find-help
on:
  workflow_dispatch:
  push:
    paths:
      - '.github/workflows/report.yml'

name: Generate report using latest kthcorpus container

jobs:
  docker:
    runs-on: ubuntu-latest
    container: ghcr.io/kth-library/kthcorpus
    steps:

      - shell: bash
        env:
          MC_HOST_kthb: ${{ secrets.MC_HOST_KTHB }}
        run: |
          mc ls kthb/kthcorpus

      - run: |
          R -e 'library(kthcorpus); library(rmarkdown); render(system.file(package = "kthcorpus", "rmarkdown", "checks-report.Rmd"))'
          R -e 'file.copy(system.file(package = "kthcorpus", "rmarkdown", "checks-report.html"), "/tmp/checks-report.html")'

      - name: Upload results
        uses: actions/upload-artifact@main
        with:
          name: report
          path: /tmp/checks-report.html
