# Workflow derived from https://github.com/r-lib/actions/tree/v2/examples
# Need help debugging build failures? Start at https://github.com/r-lib/actions#where-to-find-help
on:
  workflow_dispatch:
  push:
    paths:
      - '.github/workflows/report.yml'
  schedule:
    - cron: '49 1 * * *' # UTC 49th min after 01th hour every day of month, month, day of week

name: Generate report using latest kthcorpus container

jobs:
  docker:
    runs-on: ubuntu-latest
    container: ghcr.io/kth-library/kthcorpus
    env:
      MC_HOST_kthb: ${{ secrets.MC_HOST_KTHB }}
    steps:
      - run: |
          R -e 'library(kthcorpus); report <- checks_render_report(); checks_upload_report(report)'

      - name: Upload results as GitHub Artifact
        uses: actions/upload-artifact@main
        with:
          name: report
          path: /tmp/checks-report.html
