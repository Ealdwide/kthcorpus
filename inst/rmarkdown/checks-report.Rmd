---
title: "Kontroller för KTHs publikationscorpus"
output:
  flexdashboard::flex_dashboard:
    logo: logo.png
    favicon: favicon.ico
    orientation: rows
    vertical_layout: fill
    theme: 
      version: 5
      font-size-base: 1
      bg: "#FFF"
      fg: "#272c30" 
      primary: "#1954A6"
      navbar-bg: "#1954A6"
      base_font: 
        google: 
          family: Open Sans
          local: true
      heading_font:
        google: 
          family: Open Sans
          local: true
      code_font:
        google: 
          family: Open Sans
          local: true
---

```{r setup, include=FALSE}
library(flexdashboard)

myDT <- function(data) {
  if (is.null(data) || nrow(data) <= 0) 
    return(htmltools::pre("No results found for this check"))
  
  DT::datatable(data, #filter = "top",
    escape = FALSE,
    rownames = FALSE,
    options = list(
      dom = 'pt',
      scrollX = "90vh", scrollY = "80vh")
    )
}

shorten <- function(x, n = 20) {
  if (nchar(x) > n) return(substr(x, 1, n))
  x
}

compact_cols <- function(data) {
  mask_keep <- colSums(!is.na(data)) > 0
  data[, mask_keep, drop = FALSE]
}

```

Kontroller {.tabset}
-----------------------------------------------------------------------

### Titelmultipletter

```{r}
library(kthcorpus)
library(dplyr)

checks <- kth_diva_checks()

myDT(checks$article_title_multiplettes)
```

### Publiceringsstatus

```{r}
myDT(checks$submission_status_invalid %>% select(-c(Name, Abstract)) %>% compact_cols())
```

### Saknade kthid:n

```{r}
myDT(checks$missing_kthid)
```

<!-- TODO: ska detta vara med? för alla publikationer?
### Saknade år/publiceringsdatum i DiVA

```{r}
myDT(checks$missing_date)
```
-->

### Saknade ISSN

```{r}
myDT(checks$missing_journal_ids  %>% select(-c(Name, Abstract)) %>% compact_cols())
```

### DOI-multipletter

```{r}
myDT(checks$multiplettes_DOI %>% select(DOI_link, everything()) %>% select(-c("DOI")))
```

### ScopusID-multipletter

```{r}
myDT(checks$multiplettes_scopusid)
```

### ISI-multipletter

```{r}
myDT(checks$multiplettes_ISI)
```


### Ogiltig ISI

```{r}
myDT(checks$invalid_ISI)
```

### Ogiltig DOI

```{r}
myDT(checks$invalid_DOI)
```

### Ogiltig ISSN

```{r}
myDT(checks$invalid_ISSN)
```

### Ogiltig organisationstillhörighet

```{r}
myDT(checks$invalid_orgid)
```

### Oklar publikationsstatus

```{r}
myDT(checks$uncertain_published)
```

### SwePubs kontroller

```{r}
myDT(swepub_checks())
```


### Information

Denna sammanställning gjordes `r Sys.time()` och innehåller resultat från kontroller gjorda på KTHs publikationsmängd som laddades ned från DiVA-portalen.

Datakällorna som användes vid kontrollerna har följande tidsstämplar:

```{r}

knitr::kable(diva_meta())

```

